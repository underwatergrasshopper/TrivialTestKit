name: Build and Test

on:
  push:
    branches: [ "main", "dev" ]
  pull_request:
    branches: [ "main" ]

env:
  SOLUTION_FILE_PATH: .

permissions:
  contents: read

jobs:
  msvc:
    strategy:
      matrix:
        os: [windows-2019, windows-2022]
        platform: [x86, x64]
        configuration: [Release, ReleaseWide]
        include:
          - os: windows-2019
            toolset: v142
          - os: windows-2022
            toolset: v143
          - platform: x86
            pathprefix:
          - platform: x64
            pathprefix: x64/
  
    runs-on: ${{ matrix.os }}

    steps:
    - uses: actions/checkout@v3

    - name: Add MSBuild to PATH
      uses: microsoft/setup-msbuild@v1.0.2

    - name: Build 
      working-directory: ${{env.GITHUB_WORKSPACE}}
      run: MSBuild /m /property:Configuration=${{ matrix.configuration }} /property:Platform=${{ matrix.platform }} /p:PlatformToolset=${{ matrix.toolset }}
      
    - name: Test
      working-directory: ${{env.GITHUB_WORKSPACE}}
      run: ${{ matrix.pathprefix }}${{ matrix.configuration }}/Test.exe
      
# Note: No build and test support for gcc. 
#  mingw:
#    runs-on: windows-latest
#    
#    steps:
#      - uses: actions/checkout@v3
#    
#      - name: Set up MinGW
#        uses: egor-tensin/setup-mingw@v2
#        with:
#          version: latest
#          platform: x64
#
#      - name: Build and Test
#        working-directory: ${{env.GITHUB_WORKSPACE}}
#        run: TestGCC_64.bat
#          